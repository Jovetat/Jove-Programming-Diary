# 双向绑定数据的时间范围组件

### 组件

`timeRange.vue`

```vue
<template>
  <view class="time-range">
    <a-form-item
      :label="props.label"
      :name="props.startProp"
      class="time-select"
    >
      <a-date-picker
        v-model:value="localStartDate"
        :valueFormat="props.format"
        :format="props.format"
        placeholder="请选择起始时间"
        :disabled-date="disabledStartDate"
      >
        <template #suffixIcon>
          <CaretDownFilled />
        </template>
      </a-date-picker>
    </a-form-item>
    <test class="content-text">到</test>
    <a-form-item :name="props.endProp" class="time-select">
      <a-date-picker
        v-model:value="localEndDate"
        :valueFormat="props.format"
        :format="props.format"
        placeholder="请选择结束时间"
        :disabled-date="disabledEndDate"
      >
        <template #suffixIcon>
          <CaretDownFilled />
        </template>
      </a-date-picker>
    </a-form-item>
  </view>
</template>

<script lang="ts">
import { defineComponent, ref, watch } from 'vue'
import moment, { Moment } from 'moment'
import { CaretDownFilled } from '@ant-design/icons-vue'

export default defineComponent({
  components: { CaretDownFilled },
  props: {
    startDate: {
      type: String,
      required: true,
    },
    endDate: {
      type: String,
      required: true,
    },
    startProp: {
      type: String,
      default: 'startDate',
    },
    endProp: {
      type: String,
      default: 'endDate',
    },
    format: {
      type: String,
      default: 'YYYY-MM-DD',
    },
    label: {
      type: String,
      default: '创建时间',
    },
  },
  emits: ['update:startDate', 'update:endDate'],
  setup(props, { emit }) {
    const localStartDate = ref<string>(props.startDate)
    const localEndDate = ref<string>(props.endDate)

    watch(
      () => props.startDate,
      (newValue) => {
        if (newValue !== localStartDate.value) {
          localStartDate.value = newValue
        }
      },
    )
    watch(
      () => props.endDate,
      (newValue) => {
        if (newValue !== localEndDate.value) {
          localEndDate.value = newValue
        }
      },
    )
    watch(localStartDate, (newValue) => {
      emit('update:startDate', newValue)
    })
    watch(localEndDate, (newValue) => {
      emit('update:endDate', newValue)
    })

    const disabledStartDate = (startValue: Moment) => {
      if (!startValue || !localEndDate.value) {
        return false
      }
      const endMoment = moment(localEndDate.value, 'YYYY-MM-DD')
      const nextDay = endMoment.clone().add(1, 'days')
      return startValue.valueOf() > nextDay.valueOf()
    }
    const disabledEndDate = (endValue: Moment) => {
      if (!endValue || !localStartDate.value) {
        return false
      }
      const startMoment = moment(localStartDate.value, 'YYYY-MM-DD')
      return endValue.valueOf() < startMoment.valueOf()
    }

    return {
      props,
      localStartDate,
      localEndDate,
      disabledStartDate,
      disabledEndDate,
    }
  },
})
</script>

<style lang="scss" scoped>
.time-range {
  display: flex;
}
.content-text {
  display: block;
  padding: 0 10px;
  line-height: 30px;
}
</style>
```

### 使用

```vue
<timeRangeModel
  v-model:startDate="timeRangeData.startDate"
  v-model:endDate="timeRangeData.endDate"
/>
```

