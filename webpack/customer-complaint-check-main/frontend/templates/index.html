<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI打标系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">AI打标系统</h1>
        
        <!-- Main Tabs -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="processing-tab" data-bs-toggle="tab" data-bs-target="#processing" type="button" role="tab">音频处理</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="correction-tab" data-bs-toggle="tab" data-bs-target="#correction" type="button" role="tab">标签修正</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="evaluation-tab" data-bs-toggle="tab" data-bs-target="#evaluation" type="button" role="tab">标签评估</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="file-browser-tab" data-bs-toggle="tab" data-bs-target="#file-browser" type="button" role="tab">文件浏览</button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabsContent">
            <!-- Audio Processing Tab -->
            <div class="tab-pane fade show active" id="processing" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>输入音频</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs mb-3" id="audioInputTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="url-tab" data-bs-toggle="tab" data-bs-target="#url" type="button" role="tab">音频URL</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="file-tab" data-bs-toggle="tab" data-bs-target="#file" type="button" role="tab">本地文件</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="audioInputTabsContent">
                            <div class="tab-pane fade show active" id="url" role="tabpanel">
                                <form id="audioUrlForm">
                                    <div class="mb-3">
                                        <label for="audioUrl" class="form-label">音频URL</label>
                                        <input type="url" class="form-control" id="audioUrl" placeholder="请输入音频文件的URL" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary" id="processUrlBtn">处理音频URL</button>
                                </form>
                            </div>
                            
                            <div class="tab-pane fade" id="file" role="tabpanel">
                                <form id="audioFileForm">
                                    <div class="mb-3">
                                        <label for="audioFile" class="form-label">选择音频文件</label>
                                        <input class="form-control" type="file" id="audioFile" accept="audio/*" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary" id="processFileBtn">处理音频文件</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="loadingIndicator" class="text-center d-none">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">处理中...</span>
                    </div>
                    <p>正在处理音频，请稍候...</p>
                </div>

                <div id="resultsContainer" class="d-none">
                    <!-- Dialogue Segments -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>对话分段结果</h5>
                        </div>
                        <div class="card-body p-0">
                            <div id="dialogueSegments" class="segments-container p-3"></div>
                        </div>
                    </div>

                    <!-- Audio Player -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>音频播放器</h5>
                        </div>
                        <div class="card-body">
                            <audio id="audioPlayer" controls class="w-100">
                                您的浏览器不支持音频播放。
                            </audio>
                        </div>
                    </div>

                    <!-- ASR Text Results -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>ASR文本结果</h5>
                        </div>
                        <div class="card-body">
                            <pre id="asrText" class="bg-light p-3"></pre>
                        </div>
                    </div>

                    <!-- Classification Results -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>诉点分类结果</h5>
                        </div>
                        <div class="card-body">
                            <div class="complaint-result">
                                <p class="mb-1"><strong>领域：</strong><span id="complaintDomainResult"></span></p>
                                <p class="mb-1"><strong>意图：</strong><span id="complaintIntentResult"></span></p>
                                <p class="mb-1"><strong>槽位：</strong><span id="complaintThirdLevelResult"></span></p>
                                <p class="mb-0"><strong>诉点依据：</strong><span id="complaintIntentReasoning"></span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Appeal Results -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>诉求分类结果</h5>
                        </div>
                        <div class="card-body">
                            <div class="appeal-result">
                                <p class="mb-1"><strong>领域：</strong><span id="appealDomainResult"></span></p>
                                <p class="mb-1"><strong>意图：</strong><span id="appealIntentResult"></span></p>
                                <p class="mb-1"><strong>槽位：</strong><span id="appealThirdLevelResult"></span></p>
                                <p class="mb-0"><strong>诉求依据：</strong><span id="appealReasoning"></span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Solution Results -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>解决方案分类结果</h5>
                        </div>
                        <div class="card-body">
                            <div class="solution-result">
                                <p class="mb-1"><strong>领域：</strong><span id="solutionDomainResult"></span></p>
                                <p class="mb-1"><strong>意图：</strong><span id="solutionIntentResult"></span></p>
                                <p class="mb-1"><strong>槽位：</strong><span id="solutionThirdLevelResult"></span></p>
                                <p class="mb-0"><strong>解决方案依据：</strong><span id="solutionReasoning"></span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Reconciliation Results -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5>解决状态结果</h5>
                        </div>
                        <div class="card-body">
                            <div class="reconciliation-result">
                                <p class="mb-1"><strong>解决状态：</strong><span id="reconciliationResult"></span></p>
                                <p class="mb-0"><strong>解决状态依据：</strong><span id="reconciliationReasoning"></span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="errorContainer" class="alert alert-danger d-none" role="alert">
                    <h5>错误信息</h5>
                    <p id="errorMessage"></p>
                </div>
            </div>

            <!-- Tag Correction Tab -->
            <div class="tab-pane fade" id="correction" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>标签修正</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs mb-3" id="correctionInputTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="correction-file-tab" data-bs-toggle="tab" data-bs-target="#correction-file" type="button" role="tab">上传文件</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="correctionInputTabsContent">
                            <!-- File Upload Tab -->
                            <div class="tab-pane fade show active" id="correction-file" role="tabpanel">
                                <form id="correctionFileForm">
                                    <div class="mb-3">
                                        <label for="correctionFile" class="form-label">选择打标结果文件</label>
                                        <input class="form-control" type="file" id="correctionFile" accept=".xlsx" required>
                                        <div class="form-text">请选择已完成打标的Excel文件</div>
                                    </div>
                                    <button type="submit" class="btn btn-primary" id="correctionFileBtn">上传并开始修正</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="correctionLoadingIndicator" class="text-center d-none">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">加载中...</span>
                    </div>
                    <p>正在加载文件，请稍候...</p>
                </div>

                <div id="correctionContent" class="d-none">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>数据列表</h5>
                                </div>
                                <div class="card-body p-0">
                                    <div id="dataList" class="list-group list-group-flush" style="max-height: 500px; overflow-y: auto;">
                                        <!-- Data items will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Model Tags -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>模型打标结果</h5>
                                </div>
                                <div class="card-body">
                                    <div class="classification-result">
                                        <p class="mb-1"><strong>诉点领域：</strong><span id="modelComplaintDomain"></span></p>
                                        <p class="mb-1"><strong>诉点意图：</strong><span id="modelComplaintIntent"></span></p>
                                        <p class="mb-1"><strong>诉点槽位：</strong><span id="modelComplaintThirdLevel"></span></p>
                                        <p class="mb-1"><strong>诉点依据：</strong><span id="modelComplaintIntentReasoning"></span></p>
                                        
                                        <p class="mb-1"><strong>诉求领域：</strong><span id="modelAppealDomain"></span></p>
                                        <p class="mb-1"><strong>诉求意图：</strong><span id="modelAppealIntent"></span></p>
                                        <p class="mb-1"><strong>诉求槽位：</strong><span id="modelAppealThirdLevel"></span></p>
                                        <p class="mb-1"><strong>诉求依据：</strong><span id="modelAppealReasoning"></span></p>
                                        
                                        <p class="mb-1"><strong>解决方案领域：</strong><span id="modelSolutionDomain"></span></p>
                                        <p class="mb-1"><strong>解决方案意图：</strong><span id="modelSolutionIntent"></span></p>
                                        <p class="mb-1"><strong>解决方案槽位：</strong><span id="modelSolutionThirdLevel"></span></p>
                                        <p class="mb-1"><strong>解决方案依据：</strong><span id="modelSolutionReasoning"></span></p>
                                        
                                        <p class="mb-1"><strong>解决状态：</strong><span id="modelReconciliationStatus"></span></p>
                                        <p class="mb-1"><strong>解决状态依据：</strong><span id="modelReconciliationReasoning"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div id="correctionDetails" class="d-none">
                                <!-- Dialogue Segments -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5>对话分段结果</h5>
                                    </div>
                                    <div class="card-body p-0">
                                        <div id="correctionDialogueSegments" class="segments-container p-3"></div>
                                    </div>
                                </div>

                                <!-- Audio Player -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5>音频播放器</h5>
                                    </div>
                                    <div class="card-body">
                                        <audio id="correctionAudioPlayer" controls class="w-100">
                                            您的浏览器不支持音频播放。
                                        </audio>
                                    </div>
                                </div>

                                <!-- ASR Text Results -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5>ASR文本结果</h5>
                                    </div>
                                    <div class="card-body">
                                        <pre id="correctionAsrText" class="bg-light p-3"></pre>
                                    </div>
                                </div>
                                
                                <!-- Corrected Tags -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5>修正标签</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="correctionForm">
                                            <div class="row">
                                                <div class="col-md-4 mb-3">
                                                    <label for="correctedComplaintDomain" class="form-label">诉点领域</label>
                                                    <select class="form-select" id="correctedComplaintDomain">
                                                        <option value="">请选择领域</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <label for="correctedComplaintIntent" class="form-label">诉点意图</label>
                                                    <select class="form-select" id="correctedComplaintIntent">
                                                        <option value="">请选择意图</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <label for="correctedComplaintThirdLevel" class="form-label">诉点槽位</label>
                                                    <select class="form-select" id="correctedComplaintThirdLevel" name="complaint_third_level">
                                                        <option value="">请选择槽位</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-md-4 mb-3">
                                                    <label for="correctedAppealDomain" class="form-label">诉求领域</label>
                                                    <select class="form-select" id="correctedAppealDomain" name="appeal_domain">
                                                        <option value="">请选择诉求领域</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <label for="correctedAppealIntent" class="form-label">诉求意图</label>
                                                    <select class="form-select" id="correctedAppealIntent" name="appeal_intent">
                                                        <option value="">请选择诉求意图</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <label for="correctedAppealThirdLevel" class="form-label">诉求槽位</label>
                                                    <select class="form-select" id="correctedAppealThirdLevel" name="appeal_third_level">
                                                        <option value="">请选择诉求槽位</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-md-4 mb-3">
                                                    <label for="correctedSolutionDomain" class="form-label">解决方案领域</label>
                                                    <select class="form-select" id="correctedSolutionDomain" name="solution_domain">
                                                        <option value="">请选择解决方案领域</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <label for="correctedSolutionIntent" class="form-label">解决方案意图</label>
                                                    <select class="form-select" id="correctedSolutionIntent" name="solution_intent">
                                                        <option value="">请选择解决方案意图</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <label for="correctedSolutionThirdLevel" class="form-label">解决方案槽位</label>
                                                    <select class="form-select" id="correctedSolutionThirdLevel" name="solution_third_level">
                                                        <option value="">请选择解决方案槽位</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="correctedReconciliationStatus" class="form-label">解决状态</label>
                                                    <select class="form-select" id="correctedReconciliationStatus" name="reconciliation_status">
                                                        <option value="">请选择解决状态</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <!-- Empty column for spacing -->
                                                </div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="correctionReason" class="form-label">备注</label>
                                                <textarea class="form-control" id="correctionReason" name="remark" rows="3" placeholder="请输入备注"></textarea>
                                            </div>
                                            <button type="submit" class="btn btn-primary" id="saveCorrectionBtn">保存修正</button>
                                            <button type="button" class="btn btn-secondary" id="skipCorrectionBtn">跳过</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="correctionErrorContainer" class="alert alert-danger d-none" role="alert">
                    <h5>错误信息</h5>
                    <p id="correctionErrorMessage"></p>
                </div>
                
                <div id="correctionSuccessContainer" class="alert alert-success d-none" role="alert">
                    <h5>操作成功</h5>
                    <p id="correctionSuccessMessage"></p>
                    <a href="#" id="downloadCorrectedFile" class="btn btn-success">下载修正后的文件</a>
                </div>
            </div>

            <!-- Evaluation Tab -->
            <div class="tab-pane fade" id="evaluation" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>标签评估</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs mb-3" id="evalInputTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="eval-file-tab" data-bs-toggle="tab" data-bs-target="#eval-file" type="button" role="tab">上传文件</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="eval-path-tab" data-bs-toggle="tab" data-bs-target="#eval-path" type="button" role="tab">文件路径</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="evalInputTabsContent">
                            <!-- File Upload Tab -->
                            <div class="tab-pane fade show active" id="eval-file" role="tabpanel">
                                <form id="evalFileForm">
                                    <div class="mb-3">
                                        <label for="evalFile" class="form-label">选择打标结果文件</label>
                                        <input class="form-control" type="file" id="evalFile" accept=".xlsx" required>
                                        <div class="form-text">请选择已完成打标的Excel文件</div>
                                    </div>
                                    <button type="submit" class="btn btn-primary" id="evalFileBtn">上传并评估</button>
                                </form>
                            </div>
                            
                            <!-- Path Input Tab -->
                            <div class="tab-pane fade" id="eval-path" role="tabpanel">
                                <form id="evaluationForm">
                                    <div class="mb-3">
                                        <label for="taggedFilePath" class="form-label">打标结果文件路径</label>
                                        <input type="text" class="form-control" id="taggedFilePath" placeholder="请输入打标结果文件的完整路径" 
                                            value="/Users/mac/Documents/loan/tags/kesu/claim/claim1010_v1_tagged.xlsx" required>
                                        <div class="form-text">请输入已完成打标的Excel文件路径</div>
                                    </div>
                                    <button type="submit" class="btn btn-primary" id="evaluateBtn">生成评估报告</button>
                                </form>
                            </div>
                        </div>
                        
                        <div id="evalLoadingIndicator" class="text-center d-none mt-3">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">处理中...</span>
                            </div>
                            <p>正在生成评估报告，请稍候...</p>
                        </div>
                        
                        <div id="evalResultContainer" class="mt-4 d-none">
                            <div class="alert alert-success" role="alert">
                                <h5>评估完成</h5>
                                <p>评估报告已生成</p>
                                <a href="#" id="downloadLink" class="btn btn-success">下载评估报告</a>
                            </div>
                        </div>
                        
                        <div id="evalErrorContainer" class="alert alert-danger d-none mt-3" role="alert">
                            <h5>错误信息</h5>
                            <p id="evalErrorMessage"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Browser Tab -->
            <div class="tab-pane fade" id="file-browser" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>音频文件浏览</h5>
                    </div>
                    <div class="card-body">
                        <!-- Date Range Filter -->
                        <div class="row mb-3">
                            <div class="col-md-2">
                                <label for="filterStartYear" class="form-label">开始年份</label>
                                <select class="form-select" id="filterStartYear">
                                    <option value="">请选择</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="filterStartMonth" class="form-label">开始月份</label>
                                <select class="form-select" id="filterStartMonth">
                                    <option value="">请选择</option>
                                    <option value="01">01月</option>
                                    <option value="02">02月</option>
                                    <option value="03">03月</option>
                                    <option value="04">04月</option>
                                    <option value="05">05月</option>
                                    <option value="06">06月</option>
                                    <option value="07">07月</option>
                                    <option value="08">08月</option>
                                    <option value="09">09月</option>
                                    <option value="10">10月</option>
                                    <option value="11">11月</option>
                                    <option value="12">12月</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="filterEndYear" class="form-label">结束年份</label>
                                <select class="form-select" id="filterEndYear">
                                    <option value="">请选择</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="filterEndMonth" class="form-label">结束月份</label>
                                <select class="form-select" id="filterEndMonth">
                                    <option value="">请选择</option>
                                    <option value="01">01月</option>
                                    <option value="02">02月</option>
                                    <option value="03">03月</option>
                                    <option value="04">04月</option>
                                    <option value="05">05月</option>
                                    <option value="06">06月</option>
                                    <option value="07">07月</option>
                                    <option value="08">08月</option>
                                    <option value="09">09月</option>
                                    <option value="10">10月</option>
                                    <option value="11">11月</option>
                                    <option value="12">12月</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="filterCallType" class="form-label">呼叫类型</label>
                                <select class="form-select" id="filterCallType">
                                    <option value="">全部</option>
                                    <option value="call_in">呼入</option>
                                    <option value="call_out">呼出</option>
                                </select>
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button type="button" class="btn btn-primary" id="filterFilesBtn">查询</button>
                                <button type="button" class="btn btn-secondary ms-2" id="resetFilterBtn">重置</button>
                            </div>
                        </div>

                        <!-- Statistics Display -->
                        <div id="fileStatistics" class="alert alert-info d-none">
                            <h6>查询结果统计</h6>
                            <div id="statisticsContent"></div>
                        </div>

                        <!-- Loading Indicator -->
                        <div id="fileLoadingIndicator" class="text-center d-none">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">加载中...</span>
                            </div>
                            <p>正在加载文件列表，请稍候...</p>
                        </div>

                        <!-- Error Container -->
                        <div id="fileErrorContainer" class="alert alert-danger d-none" role="alert">
                            <h5>错误信息</h5>
                            <p id="fileErrorMessage"></p>
                        </div>

                        <!-- File List Table -->
                        <div id="fileTableContainer" class="d-none">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" id="fileTable">
                                    <thead>
                                        <tr>
                                            <th class="sortable" data-sort="year">
                                                年份 <span class="sort-icon"></span>
                                            </th>
                                            <th class="sortable" data-sort="month">
                                                月份 <span class="sort-icon"></span>
                                            </th>
                                            <th class="sortable" data-sort="call_type">
                                                呼叫类型 <span class="sort-icon"></span>
                                            </th>
                                            <th class="sortable" data-sort="filename">
                                                文件名称 <span class="sort-icon"></span>
                                            </th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fileTableBody">
                                        <!-- File rows will be inserted here -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pagination -->
                            <nav aria-label="文件列表分页" class="mt-3">
                                <ul class="pagination justify-content-center" id="filePagination">
                                    <!-- Pagination items will be inserted here -->
                                </ul>
                            </nav>
                        </div>

                        <!-- Empty State -->
                        <div id="fileEmptyState" class="text-center py-5 d-none">
                            <p class="text-muted">暂无数据</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>