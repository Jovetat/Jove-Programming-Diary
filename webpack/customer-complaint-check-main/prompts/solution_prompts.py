# -*- coding: utf-8 -*-

"""
Prompt templates for loan customer solution classification
Contains prompt templates for primary labels (domain), secondary labels (intent)
and tertiary labels for solution classification
"""

# 一级标签（解决方案类型）prompt
SOLUTION_DOMAIN_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

一、分类定义（严格依此定义识别“是否执行具体操作”）
## 催收业务
坐席执行了催收相关的“明确、可操作动作”，如：
- 帮忙申请停催、缓催
- 提交停催申请

## 息费业务
坐席执行了与费用/利息相关的“明确、可操作动作”，如：
- 帮忙申请退费、减免
- 给出具体的协商还款方案、减免方案
- 帮忙开通提前结清入口

## 征信业务
坐席执行了征信相关的“明确、可操作动作”，如：
- 申请删除或修改征信记录
- 处理征信异议
- 调取征信授权书
- 已上报征信或即将上报

## 其他业务
凡不属于上述三类的全部内容，包括但不限于：
- 解释政策、告知流程
- 仅安抚或致歉（如“抱歉”“非常抱歉”）
- 客服无法处理、拒绝诉求
- 回答一般咨询问题
- “帮您上报/反馈/升级”“转交专员”“等待处理”  
- “帮您加急/催促/催办”
- “帮忙注销账户”
  （此类不算具体操作，因为坐席本人没有执行处理动作）

**核心判断原则：**
只要不是“坐席亲自执行明确操作”，统统归类为 **其他业务**。

二、判断逻辑（非常重要）
请严格按照以下判断顺序执行：

1. 判断坐席是否给出了 **明确、可执行、由坐席本人操作的动作**（如“我帮您提交…申请”）
   - 若有，则根据动作性质归类为催收/息费/征信业务
   - 若没有明确操作，仅出现解释、致歉、转交专员、反馈上报，则必须归入“其他业务”
2. 若出现多种可能，以 **最后几轮** 坐席最终方案为准
3. 最终输出必须严格为以下四项之一：  
   **催收业务, 息费业务, 征信业务, 其他业务**

三、Few-Shot 示例（非常重要）

### 示例 1（催收业务）
坐席：我这边帮您申请缓催紧急联系人三天，您看可以吗。
输出：催收业务

### 示例 2（息费业务）
坐席：我这边帮您提交提前结清的申请。
输出：息费业务

### 示例 3（征信业务）
坐席：已经帮您注销成功，会在七个工作日内上报征信。
输出：征信业务

### 示例 4（其他业务 - 咨询解答）
坐席：目前我们的小程序正在维护，可以下载app进行还款。
输出：其他业务

### 示例 5（其他业务 - 升级反馈）
坐席：我会帮您反馈到高级专员那边，您耐心等待电话即可。
输出：其他业务

### 示例 6（其他业务 - 解释安抚）
坐席：非常抱歉，目前我们没有停催政策，建议按时还款。
输出：其他业务

四、任务
请根据以上规范，对以下对话中的坐席“最终解决方案类型”进行判断。

对话内容：
{text}

请严格只输出一个选项：

"""

# 二级标签"催收业务"的prompt
SOLUTION_COLLECTION_INTENT_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

可选的解决方案及描述如下：
停催: 停止对客户或第三方的催收行为
催收其他: 其他不属于停催范畴的解决方案

注意：
只要坐席提到了催收的方案，统统归类为“停催”。不要分类为“催收其他”。

严格按照以下规则进行分析和输出：
1. 以严格的JSON格式输出结果，包含两个字段：label（标签值）和reasoning（判断依据）
2. label字段只能从上述两个选项中选择：停催, 催收其他
3. reasoning字段需要简要说明判断依据，直接引用对话中的关键语句
4. 输出示例：{{"label": "停催", "reasoning": "坐席提到'我们会安排停止催收'"}}

对话内容：
{text}

请严格按照规则输出JSON格式的结果："""

# 二级标签"息费业务"的prompt
SOLUTION_FEE_INTENT_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

可选的解决方案及描述如下：
退赔: 通过线下打款方式退还费用或赔偿经济损失
协商还款: 与客户协商调整还款计划或其他协商处理方式
息费其他: 其他不属于退赔和协商还款范畴的解决方案

注意：
只要坐席提到了息费的方案，优先归类为“退赔”或“协商还款”。不要分类为“息费其他”。

严格按照以下规则进行分析和输出：
1. 以严格的JSON格式输出结果，包含两个字段：label（标签值）和reasoning（判断依据）
2. label字段只能从上述三个选项中选择：退赔, 协商还款, 息费其他
3. reasoning字段需要简要说明判断依据，直接引用对话中的关键语句
4. 输出示例：{{"label": "退赔", "reasoning": "坐席提到'我们会安排退费'"}} 

对话内容：
{text}

请严格按照规则输出JSON格式的结果："""

# 二级标签"征信业务"的prompt
SOLUTION_CREDIT_INTENT_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

可选的解决方案及描述如下：
删除逾期征信记录: 删除客户的逾期征信记录
修改征信上报内容: 修改征信上报内容
调取征信授权书: 调取征信授权书
征信异议答复: 对征信异议进行答复
征信其他: 其他不属于删除逾期征信记录、修改征信上报内容、调取征信授权书、征信异议答复范畴的解决方案

严格按照以下规则进行分析和输出：
1. 以严格的JSON格式输出结果，包含两个字段：label（标签值）和reasoning（判断依据）
2. label字段只能从上述五个选项中选择：删除逾期征信记录, 修改征信上报内容, 调取征信授权书, 征信异议答复, 征信其他
3. reasoning字段需要简要说明判断依据，直接引用对话中的关键语句
4. 输出示例：{{"label": "删除逾期征信记录", "reasoning": "坐席提到'我们会申请删除您的征信记录'"}} 

对话内容：
{text}

请严格按照规则输出JSON格式的结果："""

# 二级标签"其他业务"的prompt
SOLUTION_OTHER_INTENT_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，并按照以下严格的逻辑顺序进行分类判断。

一、分类定义（注意：分类的最终选择必须按照下面的逻辑判断顺序，而不是自由选择）
## 1. 安抚致歉
判断条件：  
- 坐席由于无法满足客户诉求，出现明确的道歉字眼，如“抱歉”“很抱歉”“不好意思”等  

## 2. 资料办理
判断条件：  
坐席明确执行了以下常规业务操作之一：  
- 办理结清证明  
- 调取合同  
- 办理发票  
- 办理还款明细  
- 提交结清申请、明细申请等  

注意：  
- 若仅是让客户“提供材料”“上传材料”“提供凭证” → 不算资料办理  
- 必须是坐席执行了明确的“办理动作”

## 3. 升级反馈
判断条件（需同时满足“升级/反馈/加急/催促” + “专员/高级专员” 或 只提到”帮您转接“）：  
必须出现明确的将问题转交给更高层级的表达，例如：  
- “升级反馈到高级专员”  
- “反馈到专员”  
- “转接到高级专员”  
- “转交给专员” 
- ”帮您转接“ 
- “帮您催促一下专员”

注意：  
以下情况不算升级反馈（归类为咨询解答）：  
- 只说“我帮您反馈一下”  
- “备注反馈一下”  
- “帮您上传材料”  

## 4. 咨询解答
如果不符合上述前三类，均归为咨询解答，包括：  
- 政策解释  
- 回答客户提问  
- 普通说明  
- 备注反馈（无专员）  
- 材料说明（非办理）  
- 普通流程提醒等

## 5. 其他
其他不属于上述四类的行为，话语中没有实质性内容。

二、最终判断逻辑（严格按顺序执行）
请按以下固定顺序判断坐席的最终解决方案类型：

1. 若话术中出现“升级/反馈/转接/转交/加急/联系/催促” + “专员/高级专员” 或 提到”帮您转接“，则归类为**升级反馈**
2. 否则，若坐席针对客服诉求出现道歉字眼，则归类为**安抚致歉**
3. 否则，若坐席执行了常规资料办理，则归类为**资料办理**
4. 否则，则归类为**咨询解答**

三、输出格式
以严格 JSON 输出，包含：  
- label（五选一：咨询解答, 安抚致歉, 资料办理, 升级反馈, 其他）  
  *按上述逻辑判断，不会出现“其他”，但仍保留选项完整性*  
- reasoning：引用坐席关键话术，简述主要判断依据

四、Few-shot 示例（用于帮助模型学习判断逻辑）

示例 1（咨询解答）
坐席：目前停催政策已经是无法办理了。
输出：
{{"label": "咨询解答", "reasoning": "仅解释政策，无道歉、无资料办理、无转交专员"}}

示例 2（咨询解答）
坐席：您上传好材料后，我这边帮你备注反馈一下。
输出：
{{"label": "咨询解答", "reasoning": "仅备注反馈，没有提到专员"}}

示例 3（安抚致歉）
坐席：您希望的停催坐席这边无法办理，非常抱歉。
输出：
{{"label": "安抚致歉", "reasoning": "出现“非常抱歉”，归类为安抚致歉"}}

示例 4（资料办理）
坐席：好的，我这边帮您提交提前结清申请。
输出：
{{"label": "资料办理", "reasoning": "明确执行提交结清申请的办理操作"}}

示例 5（升级反馈）
坐席：我这边先帮您升级反馈到高级专员，稍后由他们联系您处理。
输出：
{{"label": "升级反馈", "reasoning": "包含“升级反馈到高级专员”"}}  

示例 5（升级反馈）
坐席：好的，我这边帮您转接，请稍后。
输出：
{{"label": "升级反馈", "reasoning": "包含“帮您转接”"}}  

五、任务
请根据上述定义与逻辑，对以下对话中坐席“最终给出的解决方案类型”进行判断，并以 JSON 输出。

对话内容：
{text}

请严格按照要求输出 JSON 格式的结果：

"""

# 三级标签"停催"的prompt
SOLUTION_STOP_COLLECTION_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

可选的解决方案及描述如下：
停催本人: 停止对本人的催收，并停止对第三方的催收，即全面停催
部分还款停催本人: 在部分还款后停止对本人的催收和第三方的催收
仅停催三方: 仅停止对第三方联系人的催收
其他停催: 其他类型的停催解决方案

严格按照以下规则进行分析和输出：
1. 以严格的JSON格式输出结果，包含两个字段：label（标签值）和reasoning（判断依据）
2. label字段只能从上述四个选项中选择：停催本人, 部分还款停催本人, 仅停催三方, 其他停催
3. reasoning字段需要简要说明判断依据，直接引用对话中的关键语句
4. 输出示例：{{"label": "停催本人", "reasoning": "坐席提到'我们会安排停止对您的催收'"}} 

对话内容：
{text}

请严格按照规则输出JSON格式的结果："""

# 三级标签"退赔"的prompt
SOLUTION_REFUND_COMPENSATE_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

可选的解决方案及描述如下：
退费: 通过线下打款方式退还费用
赔偿: 通过线下打款方式赔偿经济损失
其他退赔: 其他类型的退赔解决方案

严格按照以下规则进行分析和输出：
1. 以严格的JSON格式输出结果，包含两个字段：label（标签值）和reasoning（判断依据）
2. label字段只能从上述三个选项中选择：退费, 赔偿, 其他退赔
3. reasoning字段需要简要说明判断依据，直接引用对话中的关键语句
4. 输出示例：{{"label": "退费", "reasoning": "坐席提到'我们会安排退费'"}} 

对话内容：
{text}

请严格按照规则输出JSON格式的结果："""

# 三级标签"协商还款"的prompt
SOLUTION_REPAYMENT_NEGOTIATION_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

可选的解决方案及描述如下：
无减免一次性结清: 一次性结清账务，且不进行费用减免
有减免一次性结清: 一次性结清账务，并进行一定的费用减免
延期还款: 延期还款
再分期: 对欠款进行再分期
其他协商还款: 其他类型的协商还款解决方案

严格按照以下规则进行分析和输出：
1. 以严格的JSON格式输出结果，包含两个字段：label（标签值）和reasoning（判断依据）
2. label字段只能从上述五个选项中选择：无减免一次性结清, 有减免一次性结清, 延期还款, 再分期, 其他协商还款
3. reasoning字段需要简要说明判断依据，直接引用对话中的关键语句
4. 输出示例：{{"label": "无减免一次性结清", "reasoning": "坐席提到'可以申请一次性结清'"}} 

对话内容：
{text}

请严格按照规则输出JSON格式的结果："""

# 三级标签"安抚致歉"的prompt
SOLUTION_COMFORT_APOLOGY_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

可选的解决方案及核心定义（优先匹配前两类，仅无匹配时选第三类）：
道歉: 道歉: 口头或书面道歉
解释安抚: 核心为向客户解释公司业务规则/政策，或通过安抚类表述缓解客户情绪（如“请您理解”“这是因为XX业务规则”“您别着急”“我跟您说明一下这个流程”“这是正常的业务规定”“您希望的停催坐席这边无法办理，非常抱歉“，“非常抱歉，目前我们没有停催政策，建议按时还款。“等）
其他安抚致歉: 除“道歉”“解释安抚”之外的其他安抚致歉类解决方案（无上述两类核心表述时选择）


严格按照以下规则进行分析和输出：
1. 以严格的JSON格式输出结果，包含两个字段：label（标签值）和reasoning（判断依据）
2. label字段只能从上述三个选项中选择：道歉, 解释安抚, 其他安抚致歉
3. reasoning字段需要简要说明判断依据，直接引用对话中的关键语句
4. 输出示例：{{"label": "道歉", "reasoning": "坐席提到'我们对此表示歉意'"}} 

对话内容：
{text}

请严格按照规则输出JSON格式的结果："""

# 三级标签"资料办理"的prompt
SOLUTION_DOCUMENT_PROCESSING_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

可选的解决方案及描述如下：
办理结清证明: 办理结清证明
办理发票: 办理发票
调取合同: 调取合同
办理还款明细: 办理还款明细
其他资料办理: 其他类型的资料办理解决方案

严格按照以下规则进行分析和输出：
1. 以严格的JSON格式输出结果，包含两个字段：label（标签值）和reasoning（判断依据）
2. label字段只能从上述五个选项中选择：办理结清证明, 办理发票, 调取合同, 办理还款明细, 其他资料办理
3. reasoning字段需要简要说明判断依据，直接引用对话中的关键语句
4. 输出示例：{{"label": "办理结清证明", "reasoning": "坐席提到'我们会为您开具结清证明'"}} 

对话内容：
{text}

请严格按照规则输出JSON格式的结果："""

# 三级标签"升级反馈"的prompt
SOLUTION_UPGRADE_FEEDBACK_PROMPT_TEMPLATE = """您是一位专业的金融客服对话分析专家。下面仅给出坐席的话语，请仔细阅读，重点关注坐席最后几轮的表述，以判断坐席最终给出的解决方案类型。

可选的解决方案及核心定义（优先匹配前两类，仅无匹配时选第三类）：
升级处理: 核心为将客户问题上报/反馈/升级、转交专员处理、告知客户等待相关部门处理（包含“帮您上报”“帮您反馈”“帮您升级”“转交专员”“等待处理”等关键表述）
加急催办: 核心为针对客户已有上报/升级的问题，明确提出加急催促办理（包含“加急催办”“加急处理”“尽快催促”等关键表述）
其他升级反馈: 除“升级处理”“加急催办”之外的其他升级类反馈解决方案（无上述两类核心表述时选择）

严格按照以下规则进行分析和输出：
1. 以严格的JSON格式输出结果，包含两个字段：label（标签值）和reasoning（判断依据）
2. label字段只能从上述三个选项中选择：升级处理, 加急催办, 其他升级反馈
3. reasoning字段需要简要说明判断依据，直接引用对话中的关键语句
4. 输出示例：{{"label": "升级处理", "reasoning": "坐席提到'我们会将您的问题升级处理'"}} 

对话内容：
{text}

请严格按照规则输出JSON格式的结果："""